<app-container [config]="containerConfig">
  <div class="content">
    <mat-form-field floatPlaceholder="always" *ngIf="centerList&&centerList.length!==0"
                    style="width: 80%;margin-right: 1em">
      <mat-select placeholder="中心" [(ngModel)]="centerId" name="center" (change)="centerChange($event)"
                  (onOpen)="centerChange({value:centerId})">
        <mat-option *ngFor="let opt of centerList" [value]="opt.menuId">{{opt.name}}</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field floatPlaceholder="always" *ngIf="siteList&&siteList.length!==0"
                    style="width: 80%;margin-right: 1em">
      <mat-select placeholder="站点" [(ngModel)]="siteId" name="site"
                  (change)="siteChange($event)">
        <mat-option *ngFor="let opt of siteList" [value]="opt.menuId">{{opt.name}}</mat-option>
      </mat-select>
    </mat-form-field>
    <button *ngIf="(centerList&&centerList.length!==0)||(siteList&&siteList.length!==0)" mat-icon-button
            color="primary" type="button" (click)="search()">
      <mat-icon>search</mat-icon>
    </button>
    <button *ngIf="(centerList&&centerList.length!==0)||(siteList&&siteList.length!==0)" mat-icon-button
            color="primary" type="button" (click)="reset()">
      <mat-icon>autorenew</mat-icon>
    </button>
    <div style="padding: 30px 0 15px 0">
      <h2>排班及号源维护 - {{orgName}}</h2>
      <div style="padding: 30px;text-align: center" *ngIf="show=='false'">
        该机构无排班及号源信息
      </div>
    </div>
    <mat-tab-group dynamicHeight="true" [selectedIndex]="tab" *ngIf="show!='false'">
      <mat-tab label="排班表">
        <div class="table-container clear">
          <table class="table" *ngIf="weekListAm&&weekListPm">
            <thead>
            <tr>
              <th></th>
              <th>周一</th>
              <th>周二</th>
              <th>周三</th>
              <th>周四</th>
              <th>周五</th>
              <th>周六</th>
              <th>周日</th>
            </tr>
            </thead>
            <tbody>
            <tr>
              <td>上午</td>
              <td *ngFor="let obj of weekListAm">
                <mat-checkbox [(ngModel)]="obj.workState" [disabled]="operationWeek!=1"></mat-checkbox>
              </td>
            </tr>
            <tr>
              <td>下午</td>
              <td *ngFor="let obj of weekListPm">
                <mat-checkbox [(ngModel)]="obj.workState" [disabled]="operationWeek!=1"></mat-checkbox>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <p>温馨提示：请设置排班表，再维护号源。
          <mat-icon class="icon">check_box_outline_blank</mat-icon>
          表示不上班，
          <mat-icon class="icon">check_box</mat-icon>
          表示上班
        </p>
        <div class="button-content" *ngIf="operationWeek==1">
          <button mat-raised-button color="primary" (click)="saveWeekList()">保存</button>
        </div>
      </mat-tab>
      <mat-tab label="疫苗维护">
        <app-plan-vaccine 
          [orgId]="siteId || this.centerId"
          [vaccineSchedule]="vaccineSchedule" 
          (save)="getVaccineSchedule()"></app-plan-vaccine>
      </mat-tab>
      <mat-tab label="号源维护">
        <form #form="ngForm" (submit)="saveTimeList(form)"
              *ngIf="timeList1&&timeList2&&timeList3&&timeList4&&timeList5&&timeList6">
          <div class="table-container clear">
            <table class="table">
              <thead>
              <tr>
                <th>
                  <div style="min-width:100px"></div>
                </th>
                <th>周一</th>
                <th>周二</th>
                <th>周三</th>
                <th>周四</th>
                <th>周五</th>
                <th>周六</th>
                <th>周日</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td>08:00 - 09:00</td>
                <td *ngFor="let obj of timeList1;let i = index">
                  <input class="time-input" type="text" name="stock1{{i}}" [(ngModel)]="obj.stock"
                         [disabled]="!obj.workState||(operationTime!=1)" pattern="^[0-9]{1,4}$" #stock1{{i}}="ngModel"
                         [class.error]="form.controls['stock1' + i]&&form.controls['stock1' + i].invalid">
                </td>
              </tr>
              <tr>
                <td>09:00 - 10:00</td>
                <td *ngFor="let obj of timeList2;let i = index">
                  <input class="time-input" type="text" name="stock2{{i}}" [(ngModel)]="obj.stock"
                         [disabled]="!obj.workState||(operationTime!=1)" pattern="^[0-9]{1,4}$" #stock2{{i}}="ngModel"
                         [class.error]="form.controls['stock2' + i]&&form.controls['stock2' + i].invalid">
                </td>
              </tr>
              <tr>
                <td>10:00 - 11:00</td>
                <td *ngFor="let obj of timeList3;let i = index">
                  <input class="time-input" type="text" name="stock3{{i}}" [(ngModel)]="obj.stock"
                         [disabled]="!obj.workState||(operationTime!=1)" pattern="^[0-9]{1,4}$" #stock3{{i}}="ngModel"
                         [class.error]="form.controls['stock3' + i]&&form.controls['stock3' + i].invalid">
                </td>
              </tr>
              <tr>
                <td>13:00 - 14:00</td>
                <td *ngFor="let obj of timeList4;let i = index">
                  <input class="time-input" type="text" name="stock4{{i}}" [(ngModel)]="obj.stock"
                         [disabled]="!obj.workState||(operationTime!=1)" pattern="^[0-9]{1,4}$" #stock4{{i}}="ngModel"
                         [class.error]="form.controls['stock4' + i]&&form.controls['stock4' + i].invalid">
                </td>
              </tr>
              <tr>
                <td>14:00 - 15:00</td>
                <td *ngFor="let obj of timeList5;let i = index">
                  <input class="time-input" type="text" name="stock5{{i}}" [(ngModel)]="obj.stock"
                         [disabled]="!obj.workState||(operationTime!=1)" pattern="^[0-9]{1,4}$" #stock5{{i}}="ngModel"
                         [class.error]="form.controls['stock5' + i]&&form.controls['stock5' + i].invalid">
                </td>
              </tr>
              <tr>
                <td>15:00 - 16:00</td>
                <td *ngFor="let obj of timeList6;let i = index">
                  <input class="time-input" type="text" name="stock6{{i}}" [(ngModel)]="obj.stock"
                         [disabled]="!obj.workState||(operationTime!=1)" pattern="^[0-9]{1,4}$" #stock6{{i}}="ngModel"
                         [class.error]="form.controls['stock6' + i]&&form.controls['stock6' + i].invalid">
                </td>
              </tr>
              </tbody>
            </table>
          </div>
          <p class="errMsg" *ngIf="!form.valid&&(operationTime==1)">* 请填写正确的号源（小于10000的非负整数）</p>
          <p>温馨提示：请设置排班表，再维护号源。
            <span *ngIf="timeList1&&timeList2&&timeList3&&timeList4&&timeList5&&timeList6">
            点击单元格直接编辑数字，无排班日期的时间不用设置号源。
          </span>
          </p>
          <div class="button-content"
               *ngIf="timeList1&&timeList2&&timeList3&&timeList4&&timeList5&&timeList6&&(operationTime==1)">
            <button mat-raised-button color="primary" [disabled]="!form.valid" type="submit">保存</button>
          </div>
        </form>
      </mat-tab>
      <mat-tab label="排班日历表">
        <div class="tab-content">
          <app-calendar [viewDate]="viewDate"
                        [events]="events"
                        (dayClick)="handleDayClick($event)">
          </app-calendar>
          <p style="padding: 1em 0">温馨提示：特殊节假日请选择具体日期单独设置</p>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</app-container>
